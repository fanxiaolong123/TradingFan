# TradingView Pine Script 使用指南

## 策略参数详解

### 核心策略参数
```
短期均线周期: 24（24小时）
长期均线周期: 72（72小时）
RSI周期: 14
RSI超买线: 70
RSI超卖线: 30
动量周期: 48（48小时）
动量阈值: 0.02（2%）
成交量阈值: 1.5（1.5倍平均成交量）
```

### 仓位管理参数
```
基础仓位: 30%
动态仓位: 开启
最大仓位: 90%
凯利系数: 0.25
```

### 风险管理参数
```
止损: 3%
止盈: 6%
移动止损: 开启
移动止损触发: 1%
移动止损距离: 2%
最大回撤限制: 10%
ATR倍数: 2.0
```

## TradingView 使用步骤

### 1. 添加策略到TradingView

1. 打开 TradingView.com
2. 登录你的账户
3. 打开 BTCUSDT 1小时图表
4. 点击底部的 "Pine Editor"
5. 复制粘贴策略代码
6. 点击 "添加到图表"

### 2. 策略配置

#### 基础版本（简单易用）
- 使用 `btc_momentum_tradingview.pine`
- 固定30%仓位
- 基础止损止盈
- 适合新手使用

#### 高级版本（专业功能）
- 使用 `btc_momentum_advanced_tv.pine`
- 动态仓位管理
- 凯利公式优化
- 移动止损
- 风险控制

### 3. 参数调整建议

#### 保守型设置
```
基础仓位: 20%
止损: 2%
止盈: 4%
最大回撤限制: 5%
```

#### 激进型设置
```
基础仓位: 50%
止损: 4%
止盈: 8%
最大回撤限制: 15%
```

## TradingView 仓位管理功能

### 支持的功能

✅ **完整仓位管理**
- 可以设置固定仓位大小
- 可以按资金百分比交易
- 支持复合增长（盈利再投资）

✅ **高级风险控制**
- 止损止盈
- 移动止损
- 最大回撤控制
- 动态仓位调整

✅ **资金管理**
- 凯利公式计算最优仓位
- 基于ATR的动态止损
- 资金曲线追踪

✅ **性能分析**
- 实时胜率统计
- 盈亏比计算
- 夏普比率
- 最大回撤

### 策略回测功能

TradingView的策略回测功能非常强大：

1. **完整交易模拟**
   - 真实的买入卖出
   - 手续费计算
   - 滑点模拟

2. **资金管理**
   - 初始资金设置
   - 仓位大小控制
   - 复合增长

3. **详细报告**
   - 交易列表
   - 性能指标
   - 图表分析

## 信号与策略的区别

### 信号脚本（Indicator）
- 只显示买卖信号
- 不进行实际交易模拟
- 无法计算收益
- 适合信号提醒

### 策略脚本（Strategy）
- 完整交易模拟
- 真实资金管理
- 详细性能报告
- 适合策略验证

**建议：使用策略脚本进行回测！**

## 实战使用技巧

### 1. 优化参数
- 使用TradingView的策略测试器
- 调整参数观察表现变化
- 避免过度优化

### 2. 多时间框架验证
- 在不同时间段测试
- 验证策略稳定性
- 观察不同市场环境表现

### 3. 风险控制
- 设置合理的最大回撤
- 使用移动止损保护利润
- 根据胜率调整仓位

### 4. 实盘准备
- 纸上交易验证
- 小仓位开始
- 逐步增加仓位

## 代码特色功能

### 1. 信息面板
- 实时显示指标数值
- 策略状态监控
- 性能指标追踪

### 2. 可视化增强
- 买卖点标记
- 止损止盈线显示
- 趋势背景色

### 3. 智能仓位
- 凯利公式计算
- 市场状态评估
- 风险动态调整

### 4. 风险保护
- 最大回撤限制
- 移动止损
- ATR动态止损

## 注意事项

1. **回测局限性**
   - 历史表现不代表未来
   - 回测可能存在前瞻性偏差
   - 实盘滑点和延迟

2. **参数调整**
   - 避免过度优化
   - 保持参数的合理性
   - 定期评估策略表现

3. **风险管理**
   - 严格执行止损
   - 控制单次风险敞口
   - 分散投资降低风险

## 常见问题

**Q: 为什么我的结果和Python回测不一样？**
A: 可能的原因：
- 手续费设置不同
- 数据源差异
- 执行逻辑细节差异

**Q: 如何设置移动止损？**
A: 在高级版本中已集成，也可以手动设置：
```pine
strategy.exit("Exit", trail_price=close*1.01, trail_offset=close*0.02)
```

**Q: 可以用于其他币种吗？**
A: 可以，但建议：
- 根据币种特性调整参数
- 重新测试策略表现
- 考虑波动率差异